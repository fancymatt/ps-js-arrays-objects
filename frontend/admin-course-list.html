<!DOCTYPE html>
<html lang="en">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Admin - Globomantics Company Onboarding</title>
        <link rel="stylesheet" href="reset.css">
        <link rel="stylesheet" href="styles.css">
    </head>
    <body>
        <header class="header">
            <nav class="main-nav">
                <ul>
                    <li><a href="course-list.html">Course List</a></li>
                    <li><a href="notebook.html">Your Notebook</a></li>
                </ul>
            </nav>
            <nav class="admin-nav">
                <ul>
                    <li><a href="admin-course-list.html">Admin</a></li>
                </ul>
            </nav>
        </header>
        <div class="title"><h1>Admin</h1></div>
        <div class="course-list">
            <ul id="course-list-root">

            </ul>
        </div> 
    </body>
    <script>
        let courseList = [];
        let courseListRoot = document.getElementById("course-list-root");

        let fetchCourses = async function() {
            courseList = [];
            fetch('http://localhost:8000/api/courses')
                .then(response => response.json())
                .then(json => {
                    json.courses.forEach(course => {
                        courseList.push(parseCourseJsonAsCourse(course));
                    });
                    updateCourseListDisplay();
                });
        };

        let parseCourseJsonAsCourse = function(jsonCourse) {
            let coursePrototype = {
                title: "New course",
                author: "No author",
                id: "No id"
            };
            const newCourse = Object.create(coursePrototype);
            Object.assign(newCourse, jsonCourse);
            return newCourse;
        };

        let updateCourseListDisplay = function() {
            courseListRoot.innerHTML = '';
            courseList.forEach(course => {
                const li = document.createElement("li");
                const h2 = document.createElement("h2");
                h2.innerHTML = course.title;
                li.appendChild(h2);
                let studyBtn = document.createElement("a");
                studyBtn.innerHTML = "Edit"
                studyBtn.href = "admin-edit-course.html?id=" + course.id;
                studyBtn.classList.add("button");
                li.appendChild(studyBtn);
                courseListRoot.appendChild(li);
            });
            appendAddCourseButton();
        };

        let appendAddCourseButton = function() {
            const li = document.createElement("li");
            let createBtn = document.createElement("button");
            createBtn.innerHTML = "Create New Course";
            createBtn.classList.add("button");
            createBtn.addEventListener('click', () => {
                createNewCourse();
            });
            li.appendChild(createBtn);
            courseListRoot.appendChild(li);
        };

        let createNewCourse = async function() {
            fetch('http://localhost:8000/api/course', {
                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }
            })
            .then(response => {
                if (response.status == "200") {
                    fetchCourses();
                }
            });
        };

        fetchCourses();
    </script>
</html>